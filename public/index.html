<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zeabur å¤šè´¦å·ç›‘æ§é¢æ¿</title>
  <link rel="icon" type="image/png" href="/logo.png">
  <link rel="shortcut icon" href="/logo.png">
  <link rel="icon" href="/logo.png" sizes="32x32">
  <meta name="msapplication-TileImage" content="/logo.png">
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    ::-webkit-scrollbar {
      display: none !important;
    }

    :root {
      --primary-color: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --secondary-color: #f97316;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --info-color: #3b82f6;

      /* Light theme */
      --bg-primary: #ffffff;
      --bg-secondary: #f9fafb;
      --bg-tertiary: #f3f4f6;
      --text-primary: #111827;
      --text-secondary: #4b5563;
      --text-tertiary: #6b7280;
      --border-color: #e5e7eb;
      --card-bg: #ffffff;
      --card-shadow: 5px 5px 8px -5px rgba(0, 0, 0, 0.1), 0 7px 7px -7px rgba(0, 0, 0, 0.04);
      --card-hover-shadow: 5px 5px 6px 0px rgb(0 0 0 / 0%), 4px 4px 5px 0px rgb(0 0 0 / 9%);
      --modal-overlay: rgba(0, 0, 0, 0.5);
      --input-bg: #ffffff;
      --input-border: #d1d5db;
      --input-focus-border: #6366f1;
      --button-primary-bg: #6366f1;
      --button-primary-hover: #4f46e5;
      --button-secondary-bg: #f3f4f6;
      --button-secondary-hover: #e5e7eb;
      --status-running: #10b981;
      --status-stopped: #ef4444;
      --status-suspended: #f59e0b;
      --status-deploying: #8b5cf6;
      --status-paused: #6b7280;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-primary: #111827;
        --bg-secondary: #1f2937;
        --bg-tertiary: #374151;
        --text-primary: #f9fafb;
        --text-secondary: #d1d5db;
        --text-tertiary: #9ca3af;
        --border-color: #374151;
        --card-bg: #1f2937;
        --card-shadow: 2px 2px 2px 0px rgba(0, 0, 0, 0.3), 2px 2px 2px 0px rgba(0, 0, 0, 0.2);
        --card-hover-shadow: 5px 5px 6px 0px rgba(0, 0, 0, 0.3), 4px 4px 5px 0px rgba(0, 0, 0, 0.2);
        --modal-overlay: rgba(0, 0, 0, 0.7);
        --input-bg: #374151;
        --input-border: #4b5563;
        --input-focus-border: #6366f1;
        --button-primary-bg: #6366f1;
        --button-primary-hover: #4f46e5;
        --button-secondary-bg: #374151;
        --button-secondary-hover: #4b5563;
        --status-running: #10b981;
        --status-stopped: #ef4444;
        --status-suspended: #f59e0b;
        --status-deploying: #8b5cf6;
        --status-paused: #6b7280;
      }
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      transition: background-color 0.3s, color 0.3s;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 500;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background-color: var(--button-primary-bg);
      color: white;
    }

    .btn-primary:hover {
      box-shadow: var(--card-shadow);
    }

    .btn-primary:active {
      transform: scale(0.995);
    }

    .btn-secondary {
      background-color: var(--button-secondary-bg);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background-color: var(--button-secondary-hover);
    }

    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background-color: #dc2626;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .info-card {
      display: none;
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid var(--border-color);
    }

    .info-card-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary-color);
    }

    .info-card-content {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .stat-card {
      padding: 8px 20px;
      gap: 0px;
      background-color: var(--card-bg);
      border-radius: 10px;
      display: flex;
      align-items: center;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--border-color);
      transition: transform 0.3s, box-shadow 0.3s;
      justify-content: space-between;
      align-content: center;
    }

    .stat-card:hover {
      transform: translateY(-1px);
      box-shadow: var(--card-hover-shadow);
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .account-card {
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--border-color);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    /* .account-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--card-hover-shadow);
    } */

    .account-header {
      padding-left: 18px !important;
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 10px;
      border: 1px solid var(--border-color);
      transition: transform 0.3s, box-shadow 0.3s;
      height: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .account-header:hover {
      box-shadow: var(--card-shadow);
    }

    .account-header:active {
      transform: scale(0.995);
    }

    .account-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .account-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .account-email {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .account-balance {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }

    .balance {
      font-size: 16px;
      font-weight: 700;
      color: var(--success-color);
    }

    .balance.low {
      color: var(--warning-color);
    }

    .balance.critical {
      color: var(--danger-color);
    }

    .ai-balance {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .project-card {
      box-shadow: var(--card-shadow);
      background-color: var(--card-bg);
      border-radius: 10px;
      padding: 12px;
      border: 1px solid var(--border-color);
      transition: transform 0.3s, box-shadow 0.3s;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .project-card:hover {
      transform: translateY(-1px);
      box-shadow: var(--card-hover-shadow);
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .project-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .project-info {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-bottom: 8px;
    }

    .project-cost {
      font-size: 16px;
      font-weight: 700;
      color: var(--info-color);
    }

    .project-stats {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .services-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .service-item {
      background-color: var(--bg-secondary);
      border-radius: 6px;
      padding: 8px;
      border: 1px solid var(--border-color);
      transition: all 0.15s;
    }

    .service-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .service-name {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .service-status {
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-running {
      background-color: rgba(16, 185, 129, 0.2);
      color: var(--status-running);
    }

    .status-stopped {
      background-color: rgba(239, 68, 68, 0.2);
      color: var(--status-stopped);
    }

    .status-suspended {
      background-color: rgba(245, 158, 11, 0.2);
      color: var(--status-suspended);
    }

    .status-deploying {
      background-color: rgba(139, 92, 246, 0.2);
      color: var(--status-deploying);
    }

    .status-paused {
      background-color: rgba(107, 114, 128, 0.2);
      color: var(--status-paused);
    }

    .service-info {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-bottom: 8px;
    }

    .service-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .service-btn {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-pause {
      background-color: rgba(245, 158, 11, 0.2);
      color: var(--warning-color);
    }

    .btn-pause:hover {
      background-color: rgba(245, 158, 11, 0.3);
    }

    .btn-restart {
      background-color: rgba(59, 130, 246, 0.2);
      color: var(--info-color);
    }

    .btn-restart:hover {
      background-color: rgba(59, 130, 246, 0.3);
    }

    .btn-logs {
      background-color: rgba(139, 92, 246, 0.2);
      color: var(--status-deploying);
    }

    .btn-logs:hover {
      background-color: rgba(139, 92, 246, 0.3);
    }

    .domains-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
    }

    .domain-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background-color: var(--bg-secondary);
      border-radius: 8px;
      color: var(--primary-color);
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      border: 1px solid var(--border-color);
    }

    .domain-link:hover {
      background-color: var(--bg-tertiary);
    }

    .domain-badge {
      background-color: var(--primary-color);
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--modal-overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal {
      background-color: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--card-hover-shadow);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background-color: var(--bg-secondary);
      color: var(--text-primary);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--input-border);
      border-radius: 8px;
      font-size: 14px;
      background-color: var(--input-bg);
      color: var(--text-primary);
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--input-focus-border);
    }

    .form-textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--input-border);
      border-radius: 8px;
      font-size: 14px;
      background-color: var(--input-bg);
      color: var(--text-primary);
      transition: border-color 0.2s;
      resize: vertical;
      min-height: 120px;
      font-family: monospace;
    }

    .form-textarea:focus {
      outline: none;
      border-color: var(--input-focus-border);
    }

    .form-help {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-top: 4px;
    }

    .form-error {
      color: var(--danger-color);
      font-size: 13px;
      margin-top: 4px;
    }

    .form-success {
      color: var(--success-color);
      font-size: 13px;
      margin-top: 4px;
    }

    .account-list {
      margin-bottom: 20px;
    }

    .account-item {
      background-color: var(--bg-secondary);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .account-item-info {
      flex: 1;
    }

    .account-item-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .account-item-email {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    .divider {
      height: 1px;
      background-color: var(--border-color);
      margin: 20px 0;
    }

    .last-update {
      font-size: 14px;
      color: var(--text-tertiary);
      margin-left: auto;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .error {
      background-color: rgba(239, 68, 68, 0.1);
      color: var(--danger-color);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--text-tertiary);
    }

    .opacity-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .opacity-slider {
      width: 100px;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--border-color);
      border-radius: 2px;
      outline: none;
    }

    .opacity-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary-color);
      cursor: pointer;
    }

    .opacity-value {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      min-width: 35px;
    }

    .logs-modal {
      max-width: 900px;
      width: 90%;
      height: 80vh;
      display: flex;
      flex-direction: column;
    }

    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .logs-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--primary-color);
    }

    .logs-info {
      padding: 10px 20px;
      background-color: var(--bg-secondary);
      color: var(--text-secondary);
      font-size: 12px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .logs-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .logs-text {
      background-color: var(--bg-tertiary);
      padding: 12px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-all;
      color: var(--text-primary);
      min-height: 100%;
    }

    .logs-footer {
      padding: 12px 20px;
      border-top: 1px solid var(--border-color);
      text-align: right;
    }

    .edit-input {
      flex: 1;
      padding: 4px 8px;
      border: 1px solid var(--input-focus-border);
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      outline: none;
      background-color: var(--input-bg);
      color: var(--text-primary);
    }

    .edit-btn {
      padding: 4px 8px;
      background-color: rgba(99, 102, 241, 0.2);
      border: 1px solid rgba(99, 102, 241, 0.4);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .edit-btn:hover {
      background-color: rgba(99, 102, 241, 0.3);
    }

    .cancel-btn {
      padding: 4px 8px;
      background-color: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.4);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .cancel-btn:hover {
      background-color: rgba(239, 68, 68, 0.3);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .projects-grid {
        grid-template-columns: 1fr;
      }

      .account-header {
        background-color: var(--card-bg);
        border-radius: 10px;
        padding: 10px;
        border: 1px solid var(--border-color);
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
        display: flex;
        justify-content: space-between;
      }

      .account-balance {
        align-items: flex-start;
      }

      .modal {
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }

      .btn {
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- é¦–æ¬¡è®¾ç½®å¯†ç ç•Œé¢ -->
    <div v-if="showSetPasswordModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ğŸ‰ æ¬¢è¿ä½¿ç”¨</div>
        </div>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 24px;">è¯·è®¾ç½®ç®¡ç†å‘˜å¯†ç </p>
        <div class="form-group">
          <input v-model="setPassword" type="password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"
            @keyup.enter="setAdminPassword" />
        </div>
        <div class="form-group">
          <input v-model="setPasswordConfirm" type="password" class="form-input" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            @keyup.enter="setAdminPassword" />
        </div>
        <div v-if="setPasswordError" class="form-error">
          {{ setPasswordError }}
        </div>
        <button @click="setAdminPassword" class="btn btn-primary" style="width: 100%;">
          è®¾ç½®å¯†ç 
        </button>
      </div>
    </div>

    <!-- ç™»å½•ç•Œé¢ -->
    <div v-if="showLoginModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">ğŸ” ç®¡ç†å‘˜ç™»å½•</div>
        </div>
        <div class="form-group">
          <input v-model="loginPassword" type="password" class="form-input" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç "
            @keyup.enter="verifyPassword" />
        </div>
        <div v-if="loginError" class="form-error">
          {{ loginError }}
        </div>
        <button @click="verifyPassword" class="btn btn-primary" style="width: 100%;">
          ç™»å½•
        </button>
      </div>
    </div>

    <div v-if="isAuthenticated" class="container">
      <div class="header">
        <h1 class="title">ğŸš€ Zeabur å¤šè´¦å·ç›‘æ§é¢æ¿</h1>
        <div class="last-update">ä¸Šæ¬¡æ›´æ–°: {{ lastUpdate }}</div>
      </div>

      <div class="info-card">
        <div class="info-card-title">ğŸ’¡ ä½¿ç”¨è¯´æ˜</div>
        <div class="info-card-content">
          æ•°æ®æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-primary" @click="fetchData" :disabled="loading">
          <i class="fas fa-sync-alt"></i>
          {{ loading ? 'åŠ è½½ä¸­...' : 'åˆ·æ–°æ•°æ®' }}
        </button>
        <button class="btn btn-secondary" @click="showManageModal = true">
          <i class="fas fa-cog"></i>
          ç®¡ç†è´¦å·
        </button>
        <button class="btn btn-danger" @click="clearCache">
          <i class="fas fa-trash"></i>
          æ¸…é™¤ç¼“å­˜
        </button>

      </div>

      <!-- æ—¥å¿—æ¨¡æ€æ¡† -->
      <div v-if="showLogsModal" class="modal-overlay" @click.self="showLogsModal = false">
        <div class="modal logs-modal">
          <div class="logs-header">
            <div class="logs-title">ğŸ“‹ {{ logsModalTitle }}</div>
            <button class="modal-close" @click="showLogsModal = false">Ã—</button>
          </div>
          <div class="logs-info">
            <span>é¡¹ç›®: {{ logsModalInfo.project }}</span>
            <span>è´¦å·: {{ logsModalInfo.account }}</span>
            <span>æ—¥å¿—: {{ logsModalInfo.count }} æ¡</span>
            <span>æ—¶é—´: {{ logsModalInfo.time }}</span>
          </div>
          <div class="logs-content">
            <div v-if="logsLoading" style="text-align: center; padding: 40px;">â³ æ­£åœ¨åŠ è½½æ—¥å¿—...</div>
            <pre v-else class="logs-text">{{ logsContent || 'æš‚æ— æ—¥å¿—' }}</pre>
          </div>
          <div class="logs-footer">
            <button class="btn btn-primary" @click="showLogsModal = false">å…³é—­</button>
          </div>
        </div>
      </div>

      <!-- è´¦å·ç®¡ç†æ¨¡æ€æ¡† -->
      <div v-if="showManageModal" class="modal-overlay" @mousedown.self="showManageModal = false">
        <div class="modal" style="max-width: 700px;">
          <div class="modal-header">
            <div class="modal-title">âš™ï¸ è´¦å·ç®¡ç†</div>
            <button class="modal-close" @click="closeManageModal">Ã—</button>
          </div>

          <!-- è´¦å·åˆ—è¡¨ -->
          <div class="account-list">
            <!-- æ˜¾ç¤ºæœ¬åœ°ç®¡ç†çš„è´¦å· -->
            <div v-for="(account, index) in managedAccounts" :key="'local-' + index" class="account-item">
              <div class="account-item-info">
                <div class="account-item-name">{{ account.name }}</div>
                <div class="account-item-email">{{ maskEmail(account.email) || 'æœªçŸ¥é‚®ç®±' }}</div>
              </div>
              <button @click="removeAccount(index)" class="btn btn-danger">
                <i class="fas fa-trash"></i>
                åˆ é™¤
              </button>
            </div>

            <!-- æ˜¾ç¤ºæœåŠ¡å™¨é…ç½®çš„è´¦å·ï¼ˆåªè¯»ï¼‰ -->
            <div v-if="managedAccounts.length === 0 && accounts.length > 0">
              <div
                style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px; padding: 10px; background-color: var(--bg-secondary); border-radius: 6px;">
                ğŸ’¡ ä»¥ä¸‹è´¦å·æ¥è‡ªæœåŠ¡å™¨é…ç½®ï¼ˆ.env æ–‡ä»¶ï¼‰ï¼Œæ— æ³•åœ¨æ­¤åˆ é™¤
              </div>
              <div v-for="account in accounts" :key="'server-' + account.name" class="account-item">
                <div class="account-item-info">
                  <div class="account-item-name">{{ account.name }}</div>
                  <div class="account-item-email">{{ account.data?.email || account.data?.username || 'æœåŠ¡å™¨é…ç½®' }}</div>
                </div>
                <span
                  style="font-size: 12px; color: var(--text-tertiary); padding: 6px 12px; background-color: var(--bg-tertiary); border-radius: 6px;">
                  ğŸ”’ æœåŠ¡å™¨é…ç½®
                </span>
              </div>
            </div>

            <div v-if="managedAccounts.length === 0 && accounts.length === 0" class="empty-state">
              æš‚æ— è´¦å·ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ 
            </div>
          </div>

          <div class="divider"></div>

          <!-- æ·»åŠ æ–°è´¦å·è¡¨å• -->
          <div>
            <div class="modal-title" style="margin-bottom: 16px;">â• æ·»åŠ æ–°è´¦å·</div>

            <div class="form-group">
              <label class="form-label">è´¦å·åç§°</label>
              <input v-model="newAccount.name" type="text" class="form-input" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„è´¦å·" />
            </div>

            <div class="form-group">
              <label class="form-label">API Token</label>
              <input v-model="newAccount.token" type="password" class="form-input" placeholder="sk-xxxxxxxxxxxxxxxx" />
              <div class="form-help">
                åœ¨ Zeabur æ§åˆ¶å°çš„è®¾ç½®ä¸­åˆ›å»º API Token
              </div>
            </div>

            <div v-if="addAccountError" class="form-error">
              {{ addAccountError }}
            </div>

            <div v-if="addAccountSuccess" class="form-success">
              {{ addAccountSuccess }}
            </div>

            <button class="btn btn-primary" @click="addAccountToList" :disabled="addingAccount" style="width: 100%;">
              {{ addingAccount ? 'éªŒè¯ä¸­...' : 'â• æ·»åŠ åˆ°åˆ—è¡¨' }}
            </button>
          </div>

          <!-- æ‰¹é‡æ·»åŠ  -->
          <div class="divider"></div>
          <div>
            <div class="modal-title" style="margin-bottom: 16px;">ğŸ“¦ æ‰¹é‡æ·»åŠ è´¦å·</div>
            <div class="form-help">
              æ¯è¡Œä¸€ä¸ªè´¦å·ï¼Œæ”¯æŒæ ¼å¼ï¼š<code>åç§°:Token</code> æˆ– <code>åç§°ï¼šToken</code> æˆ– <code>åç§°(Token)</code> æˆ–
              <code>åç§°ï¼ˆTokenï¼‰</code>
            </div>
            <div style="position: relative; min-height: 120px;">
              <div
                style="width: 100%; min-height: 120px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 13px; font-family: monospace; white-space: pre-wrap; word-break: break-all; pointer-events: none; color: var(--text-primary); line-height: 1.5; background-color: var(--input-bg);">
                {{ maskedBatchAccounts }}</div>
              <textarea v-model="batchAccounts" @input="updateBatchDisplay" placeholder="æ¯è¡Œä¸€ä¸ªè´¦å·ï¼Œæ ¼å¼ï¼šè´¦å·åç§°:API_Token"
                class="form-textarea"
                style="position: absolute; top: 0; left: 0; color: transparent; caret-color: var(--text-primary); background: transparent; line-height: 1.5;"></textarea>
            </div>
            <div v-if="batchAddError" class="form-error">
              {{ batchAddError }}
            </div>
            <div v-if="batchAddSuccess" class="form-success">
              {{ batchAddSuccess }}
            </div>
            <button class="btn btn-primary" @click="batchAddAccounts" :disabled="addingAccount"
              style="width: 100%; margin-top: 12px;">
              {{ addingAccount ? 'æ·»åŠ ä¸­...' : 'ğŸ“¦ æ‰¹é‡æ·»åŠ ' }}
            </button>
          </div>
        </div>
      </div>

      <!-- æ—§çš„æ·»åŠ è´¦å·æ¨¡æ€æ¡†ï¼ˆä¿ç•™å…¼å®¹ï¼‰ -->
      <div v-if="showAddModal" class="modal-overlay" @mousedown.self="showAddModal = false">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">â• æ·»åŠ  Zeabur è´¦å·</div>
            <button class="modal-close" @click="closeAddModal">Ã—</button>
          </div>

          <div class="form-group">
            <label class="form-label">è´¦å·åç§°</label>
            <input v-model="newAccount.name" type="text" class="form-input" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„è´¦å·" />
          </div>

          <div class="form-group">
            <label class="form-label">API Token</label>
            <input v-model="newAccount.token" type="password" class="form-input" placeholder="sk-xxxxxxxxxxxxxxxx" />
            <div class="form-help">
              åœ¨ Zeabur æ§åˆ¶å°çš„è®¾ç½®ä¸­åˆ›å»º API Token
            </div>
          </div>

          <div v-if="addAccountError" class="form-error">
            {{ addAccountError }}
          </div>

          <div v-if="addAccountSuccess" class="form-success">
            {{ addAccountSuccess }}
          </div>

          <button class="btn btn-primary" @click="addAccount" :disabled="addingAccount" style="width: 100%;">
            {{ addingAccount ? 'éªŒè¯ä¸­...' : 'æ·»åŠ è´¦å·' }}
          </button>

          <button class="btn btn-secondary" @click="closeAddModal" style="width: 100%; margin-top: 8px;">
            å–æ¶ˆ
          </button>
        </div>
      </div>

      <div v-if="accounts.length > 0" class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">è´¦å·æ•°</div>
          <div class="stat-value">{{ accounts.length }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">é¡¹ç›®æ€»æ•°</div>
          <div class="stat-value">{{ totalProjects }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æœåŠ¡æ€»æ•°</div>
          <div class="stat-value">{{ totalServices }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">è¿è¡Œä¸­</div>
          <div class="stat-value">{{ runningServices }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ€»è´¹ç”¨</div>
          <div class="stat-value">${{ totalCost.toFixed(2) }}</div>
        </div>
      </div>

      <div v-if="loading && accounts.length === 0" class="loading">
        âš¡ æ­£åœ¨åŠ è½½æ•°æ®...
      </div>

      <div v-for="account in accounts" :key="account.name" class="account-card">
        <div class="account-header" @click="toggleAccount(account.name)">
          <div class="account-info">
            <span style="font-size: 20px; transition: transform 0.3s; display: inline-flex; align-items: center;"
              :style="{ 
          /* ä¿æŒ span ä½œä¸ºä¸€ä¸ªå®¹å™¨ï¼Œä¸æ—‹è½¬æˆ–æ—‹è½¬åˆ°ç‰¹å®šè§’åº¦ */
          transform: isAccountExpanded(account.name) ? 'rotate(0deg)' : 'rotate(0deg)' 
      }">

              <i class="fas fa-chevron-right toggle-icon" :style="{ 
           transition: 'transform 0.3s', 
           // é€»è¾‘è°ƒæ•´ï¼š
           // å±•å¼€ (true) -> 0deg (å‘ä¸‹)
           // æ”¶èµ· (false) -> 90deg (å‘å³)
           transform: isAccountExpanded(account.name) ? 'rotate(90deg)' : 'rotate(0deg)' 
       }">
              </i>
            </span>
            <div>
              <div class="account-name">{{ account.name }}</div>
              <div v-if="account.data" class="account-email">
                {{ maskEmail(account.data.email) || account.data.username }}
              </div>
            </div>
          </div>
          <div class="account-balance">
            <div v-if="account.data" class="balance" :class="getBalanceClass(account.data.credit)">
              ${{ (account.data.credit / 100).toFixed(2) }}
            </div>
            <div v-if="account.aihub && account.aihub.balance" class="ai-balance">
              ğŸ¤– AI Hub: ${{ (account.aihub.balance / 100000).toFixed(2) }}
            </div>
          </div>
        </div>

        <div v-if="account.error" class="error">
          âŒ é”™è¯¯: {{ account.error }}
        </div>

        <div v-if="account.projects && isAccountExpanded(account.name)" class="projects-grid">
          <div v-for="project in account.projects" :key="project._id" :id="'proj-' + project._id" class="project-card">
            <div class="project-header">
              <div style="flex: 1;">
                <div class="project-name">
                  <span v-if="!project.isEditing">ğŸ“¦ {{ project.name }}</span>
                  <input v-else v-model="project.editingName" @keyup.enter="saveProjectName(account, project)"
                    @keyup.esc="cancelEditProjectName(project)" @blur="saveProjectName(account, project)"
                    class="edit-input" ref="projectNameInput" />
                  <button v-if="!project.isEditing" @click="startEditProjectName(project)" class="edit-btn"
                    title="é‡å‘½åé¡¹ç›®">
                    âœï¸
                  </button>
                  <button v-else @click="cancelEditProjectName(project)" class="cancel-btn" title="å–æ¶ˆ">
                    âœ–ï¸
                  </button>
                </div>
                <div class="project-info">
                  ğŸ“ {{ project.region }}
                </div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 2px;">æœ¬æœˆç”¨é‡</div>
                <div class="project-cost">
                  ${{ formatCost(project.cost) }}
                  <span v-if="!project.hasCostData" style="font-size: 12px; color: var(--warning-color);"
                    title="æœªé…ç½®è´¹ç”¨æ•°æ®">
                    âš ï¸
                  </span>
                </div>
              </div>
            </div>
            <div class="project-stats">
              <span>ğŸ”§ {{ project.services.length }} ä¸ªæœåŠ¡</span>
              <span>âœ… {{ project.services.filter(s => s.status === 'RUNNING').length }} è¿è¡Œä¸­</span>
              <span>â¸ï¸ {{ project.services.filter(s => s.status === 'SUSPENDED').length }} å·²æš‚åœ</span>
            </div>
            <div class="services-container">
              <div v-for="service in project.services" :key="service._id" class="service-item">
                <div class="service-header">
                  <div class="service-name" :title="service.name">
                    {{ service.name }}
                  </div>
                  <div :class="['service-status', service.status.toLowerCase()]">
                    {{ service.status === 'RUNNING' ? 'è¿è¡Œä¸­' : service.status === 'SUSPENDED' ? 'å·²æš‚åœ' : service.status }}
                  </div>
                </div>
                <div v-if="service.resourceLimit" class="service-info">
                  <span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 12px;">
                    <i class="fas fa-microchip"></i>
                    {{ service.resourceLimit.cpu }}m
                  </span>
                  <span style="display: inline-flex; align-items: center; gap: 4px;">
                    <i class="fas fa-memory"></i>
                    {{ service.resourceLimit.memory }}MB
                  </span>
                </div>
                <div class="service-actions">
                  <button v-if="service.status === 'RUNNING'" @click="pauseService(account, project, service)"
                    class="service-btn btn-pause">
                    <i class="fas fa-pause"></i>
                    æš‚åœ
                  </button>
                  <button @click="restartService(account, project, service)" class="service-btn btn-restart">
                    <i class="fas fa-redo"></i>
                    {{ service.status === 'SUSPENDED' ? 'å¯åŠ¨' : 'é‡å¯' }}
                  </button>
                  <button @click="showServiceLogs(account, project, service)" class="service-btn btn-logs">
                    <i class="fas fa-file-alt"></i>
                    æ—¥å¿—
                  </button>
                </div>
              </div>
              <div v-if="project.services.length === 0" class="empty-state">
                æš‚æ— æœåŠ¡
              </div>
            </div>

            <!-- é¡¹ç›®åŸŸå -->
            <div v-if="getProjectDomains(project).length > 0" class="domains-container">
              <a v-for="domainInfo in getProjectDomains(project)" :key="domainInfo.domain"
                :href="'https://' + domainInfo.domain" target="_blank" class="domain-link">
                <i class="fas fa-globe"></i>
                <span>{{ domainInfo.domain }}</span>
                <span v-if="domainInfo.isGenerated" class="domain-badge">è‡ªåŠ¨</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div v-if="!loading && accounts.length === 0" class="error">
        æœªé…ç½®è´¦å·æˆ–æ— æ³•è·å–æ•°æ®ã€‚è¯·æ£€æŸ¥ .env é…ç½®æ–‡ä»¶ã€‚
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          accounts: [],
          loading: false,
          lastUpdate: '--:--:--',
          showAddModal: false,
          showManageModal: false,
          managedAccounts: [],
          projectCosts: {},
          newAccount: {
            name: '',
            token: '',
            balance: ''
          },
          addingAccount: false,
          addAccountError: '',
          addAccountSuccess: '',
          opacity: 39,
          expandedAccounts: {},
          refreshInterval: null,
          refreshing: false,
          lastFetchAt: 0,
          minFetchInterval: 2000,
          // å¯†ç éªŒè¯
          isAuthenticated: false,
          showLoginModal: false,
          showSetPasswordModal: false,
          loginPassword: '',
          loginError: '',
          setPassword: '',
          setPasswordConfirm: '',
          setPasswordError: '',
          // æ‰¹é‡æ·»åŠ 
          batchAccounts: '',
          maskedBatchAccounts: '',
          batchAddError: '',
          batchAddSuccess: '',
          // æ—¥å¿—æ¨¡æ€æ¡†
          showLogsModal: false,
          logsModalTitle: '',
          logsModalInfo: {},
          logsContent: '',
          logsLoading: false
        };
      },
      async mounted() {
        // æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²è®¾ç½®å¯†ç 
        const hasPasswordResponse = await fetch('/api/check-password');
        const { hasPassword } = await hasPasswordResponse.json();

        if (!hasPassword) {
          // é¦–æ¬¡ä½¿ç”¨ï¼Œæ˜¾ç¤ºè®¾ç½®å¯†ç ç•Œé¢
          this.showSetPasswordModal = true;
          return;
        }

        // æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ä¿å­˜çš„å¯†ç å’Œæ—¶é—´æˆ³
        const savedPassword = localStorage.getItem('admin_password');
        const savedTime = localStorage.getItem('password_time');

        if (savedPassword && savedTime) {
          const now = Date.now();
          const elapsed = now - parseInt(savedTime);
          const fourDays = 4 * 24 * 60 * 60 * 1000; // 4å¤©çš„æ¯«ç§’æ•°

          if (elapsed < fourDays) {
            // 4å¤©å†…ï¼Œè‡ªåŠ¨ç™»å½•
            this.loginPassword = savedPassword;
            await this.verifyPassword();
            return;
          }
        }

        // éœ€è¦è¾“å…¥å¯†ç 
        this.showLoginModal = true;
      },
        watch: {
        opacity(newVal) {
          localStorage.setItem('card_opacity', newVal);
          this.updateOpacity();
        }
      },
      beforeUnmount() {
        // æ¸…ç†å®šæ—¶å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
        if (this.refreshInterval) {
          clearInterval(this.refreshInterval);
        }
      },
      computed: {
        totalProjects() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) total += acc.projects.length;
          }
          return total;
        },
        totalServices() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) {
              for (const p of acc.projects) {
                if (p.services) total += p.services.length;
              }
            }
          }
          return total;
        },
        runningServices() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) {
              for (const p of acc.projects) {
                if (p.services) {
                  for (const s of p.services) {
                    if (s.status === 'RUNNING') total++;
                  }
                }
              }
            }
          }
          return total;
        },
        totalCost() {
          let total = 0;
          for (const acc of this.accounts) {
            if (acc.projects) {
              for (const p of acc.projects) {
                total += p.cost || 0;
              }
            }
          }
          return total;
        }
      },
      methods: {
        // è®¾ç½®å¯†ç ï¼ˆé¦–æ¬¡ï¼‰
        async setAdminPassword() {
          this.setPasswordError = '';

          if (!this.setPassword || this.setPassword.length < 6) {
            this.setPasswordError = 'å¯†ç é•¿åº¦è‡³å°‘6ä½';
            return;
          }

          if (this.setPassword !== this.setPasswordConfirm) {
            this.setPasswordError = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
            return;
          }

          try {
            const response = await fetch('/api/set-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ password: this.setPassword })
            });

            const result = await response.json();
            if (result.success) {
              // è®¾ç½®æˆåŠŸï¼Œè‡ªåŠ¨ç™»å½•
              this.loginPassword = this.setPassword;
              localStorage.setItem('admin_password', this.setPassword);
              localStorage.setItem('password_time', Date.now().toString());

              this.showSetPasswordModal = false;
              this.isAuthenticated = true;

              await this.loadManagedAccounts();
              this.loadProjectCosts();
              this.fetchData();

              // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°ï¼ˆä½¿ç”¨ç»Ÿä¸€æ–¹æ³•ï¼Œé¿å…é‡å¤åˆ›å»º intervalï¼‰
              this.startAutoRefresh();

              // åŠ è½½é€æ˜åº¦è®¾ç½®
              const savedOpacity = localStorage.getItem('card_opacity');
              if (savedOpacity) {
                this.opacity = parseInt(savedOpacity);
                this.updateOpacity();
              }
            } else {
              this.setPasswordError = result.error || 'è®¾ç½®å¤±è´¥';
            }
          } catch (error) {
            this.setPasswordError = 'è®¾ç½®å¤±è´¥: ' + error.message;
          }
        },
        // éªŒè¯å¯†ç 
        async verifyPassword() {
          this.loginError = '';
          try {
            const response = await fetch('/api/verify-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ password: this.loginPassword })
            });

            const result = await response.json();
            if (result.success) {
              this.isAuthenticated = true;
              this.showLoginModal = false;

              // ä¿å­˜å¯†ç å’Œæ—¶é—´æˆ³
              localStorage.setItem('admin_password', this.loginPassword);
              localStorage.setItem('password_time', Date.now().toString());

              await this.loadManagedAccounts();
              this.loadProjectCosts();
              this.fetchData();

              // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°ï¼ˆä½¿ç”¨ç»Ÿä¸€æ–¹æ³•ï¼Œé¿å…é‡å¤åˆ›å»º intervalï¼‰
              this.startAutoRefresh();

              // åŠ è½½é€æ˜åº¦è®¾ç½®
              const savedOpacity = localStorage.getItem('card_opacity');
              if (savedOpacity) {
                this.opacity = parseInt(savedOpacity);
                this.updateOpacity();
              }
            } else {
              this.loginError = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
            }
          } catch (error) {
            this.loginError = 'éªŒè¯å¤±è´¥: ' + error.message;
          }
        },
        // é‚®ç®±æ‰“ç 
        maskEmail(email) {
          if (!email || !email.includes('@')) return email;
          const [local, domain] = email.split('@');
          if (local.length <= 4) return email;
          const masked = local.substring(0, 2) + 'x'.repeat(local.length - 4) + local.substring(local.length - 2);
          return masked + '@' + domain;
        },
        // è·å–è¯·æ±‚å¤´ï¼ˆåŒ…å«å¯†ç ï¼‰
        getAuthHeaders() {
          return {
            'Content-Type': 'application/json',
            'x-admin-password': this.loginPassword
          };
        },
        async loadManagedAccounts() {
          try {
            // ä»æœåŠ¡å™¨åŠ è½½è´¦å·
            const response = await fetch('/api/server-accounts', {
              headers: this.getAuthHeaders()
            });
            const accounts = await response.json();
            if (accounts && accounts.length > 0) {
              this.managedAccounts = accounts;
              console.log(`ğŸ“‹ ä»æœåŠ¡å™¨åŠ è½½ ${accounts.length} ä¸ªè´¦å·`);
            }
          } catch (error) {
            console.log('âš ï¸ ä»æœåŠ¡å™¨åŠ è½½è´¦å·å¤±è´¥:', error.message);
          }
        },
        async saveManagedAccounts() {
          try {
            // ä¿å­˜åˆ°æœåŠ¡å™¨
            const response = await fetch('/api/server-accounts', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({ accounts: this.managedAccounts })
            });
            const result = await response.json();
            if (result.success) {
              console.log('âœ… è´¦å·å·²ä¿å­˜åˆ°æœåŠ¡å™¨');
            }
          } catch (error) {
            console.error('âŒ ä¿å­˜è´¦å·åˆ°æœåŠ¡å™¨å¤±è´¥:', error.message);
          }
        },
        loadProjectCosts() {
          const saved = localStorage.getItem('zeabur_project_costs');
          if (saved) {
            this.projectCosts = JSON.parse(saved);
          }
        },

        startAutoRefresh() {
          try {
            if (this.refreshInterval) {
              clearInterval(this.refreshInterval);
            }
            // 30s
            this.refreshInterval = setInterval(() => this.fetchData(), 30000);
          } catch (e) {
            console.error('startAutoRefresh error', e);
          }
        },

        stopAutoRefresh() {
          if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
          }
        },

        async fetchData() {
          // èŠ‚æµï¼šå¦‚æœè·ç¦»ä¸Šæ¬¡è¯·æ±‚å¤ªçŸ­ï¼Œè·³è¿‡
          const now = Date.now();
          if (now - this.lastFetchAt < this.minFetchInterval) return;
          if (this.refreshing) return; // é˜²æ­¢å¹¶å‘è¯·æ±‚

          this.lastFetchAt = now;
          this.refreshing = true;
          this.loading = true;
          try {
            // å¦‚æœæœ‰è´¦å·ï¼Œä½¿ç”¨è´¦å·
            if (this.managedAccounts.length > 0) {
              // æ¸…é™¤è´¦å·ä¸­çš„æ‰‹åŠ¨ä½™é¢ï¼Œè®©æœåŠ¡å™¨ä½¿ç”¨ API çœŸå®æ•°æ®
              const accountsWithoutManualBalance = this.managedAccounts.map(acc => ({
                ...acc,
                balance: null // ä¸å‘é€æ‰‹åŠ¨ä½™é¢
              }));

              const [accountsRes, projectsRes] = await Promise.all([
                fetch('/api/temp-accounts', {
                  method: 'POST',
                  headers: this.getAuthHeaders(),
                  body: JSON.stringify({ accounts: accountsWithoutManualBalance })
                }).then(r => r.json()),
                fetch('/api/temp-projects', {
                  method: 'POST',
                  headers: this.getAuthHeaders(),
                  body: JSON.stringify({
                    accounts: accountsWithoutManualBalance,
                    projectCosts: {} // ä¸å‘é€æ‰‹åŠ¨è´¹ç”¨ï¼Œè®©æœåŠ¡å™¨å°è¯•ä» API è·å–
                  })
                }).then(r => r.json())
              ]);

              console.log('API è¿”å›çš„è´¦å·æ•°æ®:', accountsRes);
              console.log('API è¿”å›çš„é¡¹ç›®æ•°æ®:', projectsRes);

              this.accounts = accountsRes.map((account, index) => {
                const projectData = projectsRes[index];
                console.log(`è´¦å· ${account.name} ä½™é¢: ${account.data?.credit} (${account.data?.credit / 100} USD)`);
                return {
                  ...account,
                  projects: projectData.projects || []
                };
              });
            } else {
              // å¦åˆ™ä½¿ç”¨æœåŠ¡å™¨é…ç½®çš„è´¦å·
              const [accountsRes, projectsRes] = await Promise.all([
                fetch('/api/accounts').then(r => r.json()),
                fetch('/api/projects').then(r => r.json())
              ]);

              this.accounts = accountsRes.map((account, index) => {
                const projectData = projectsRes[index];
                return {
                  ...account,
                  projects: projectData.projects || []
                };
              });
            }
          } catch (error) {
            console.error('è·å–æ•°æ®å¤±è´¥:', error);
            alert('è·å–æ•°æ®å¤±è´¥: ' + error.message);
          } finally {
            this.loading = false;
            this.refreshing = false;
            this.lastUpdate = new Date().toLocaleTimeString('zh-CN');
          }
        },
        getBalanceClass(credit) {
          const balance = credit / 100;
          if (balance < 10) return 'critical';
          if (balance < 50) return 'low';
          return '';
        },
        async batchAddAccounts() {
          this.batchAddError = '';
          this.batchAddSuccess = '';

          if (!this.batchAccounts.trim()) {
            this.batchAddError = 'è¯·è¾“å…¥è´¦å·ä¿¡æ¯';
            return;
          }

          const lines = this.batchAccounts.trim().split('\n');
          const accounts = [];

          // è§£ææ¯ä¸€è¡Œ
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;

            let name = '';
            let token = '';

            // å°è¯•åŒ¹é…æ‹¬å·æ ¼å¼ï¼šåç§°(token) æˆ– åç§°ï¼ˆtokenï¼‰
            const bracketMatch = line.match(/^(.+?)[ï¼ˆ(](.+?)[ï¼‰)]$/);
            if (bracketMatch) {
              name = bracketMatch[1].trim();
              token = bracketMatch[2].trim();
            } else if (line.includes(':')) {
              // å†’å·æ ¼å¼ï¼šåç§°:token
              const parts = line.split(':');
              name = parts[0].trim();
              token = parts.slice(1).join(':').trim();
            } else if (line.includes('ï¼š')) {
              // ä¸­æ–‡å†’å·æ ¼å¼ï¼šåç§°ï¼štoken
              const parts = line.split('ï¼š');
              name = parts[0].trim();
              token = parts.slice(1).join('ï¼š').trim();
            } else {
              this.batchAddError = `ç¬¬ ${i + 1} è¡Œæ ¼å¼é”™è¯¯ï¼Œæ”¯æŒçš„æ ¼å¼ï¼šåç§°:Token æˆ– åç§°ï¼šToken æˆ– åç§°(Token) æˆ– åç§°ï¼ˆTokenï¼‰`;
              return;
            }

            if (!name || !token) {
              this.batchAddError = `ç¬¬ ${i + 1} è¡Œï¼šè´¦å·åç§°æˆ– Token ä¸èƒ½ä¸ºç©º`;
              return;
            }

            accounts.push({ name, token });
          }

          if (accounts.length === 0) {
            this.batchAddError = 'æ²¡æœ‰æœ‰æ•ˆçš„è´¦å·ä¿¡æ¯';
            return;
          }

          this.addingAccount = true;
          let successCount = 0;
          let failedAccounts = [];

          // é€ä¸ªéªŒè¯å¹¶æ·»åŠ 
          for (const account of accounts) {
            try {
              const response = await fetch('/api/validate-account', {
                method: 'POST',
                headers: this.getAuthHeaders(),
                body: JSON.stringify({
                  accountName: account.name,
                  apiToken: account.token
                })
              });

              const data = await response.json();

              if (response.ok) {
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                const exists = this.managedAccounts.some(acc => acc.name === account.name);
                if (!exists) {
                  this.managedAccounts.push({
                    name: account.name,
                    token: account.token,
                    email: data.userData.email,
                    username: data.userData.username
                  });
                  successCount++;
                } else {
                  failedAccounts.push(`${account.name}ï¼ˆå·²å­˜åœ¨ï¼‰`);
                }
              } else {
                failedAccounts.push(`${account.name}ï¼ˆ${data.error || 'éªŒè¯å¤±è´¥'}ï¼‰`);
              }
            } catch (error) {
              failedAccounts.push(`${account.name}ï¼ˆç½‘ç»œé”™è¯¯ï¼‰`);
            }
          }

          this.addingAccount = false;

          if (successCount > 0) {
            await this.saveManagedAccounts();
            this.fetchData();
          }

          // æ˜¾ç¤ºç»“æœ
          if (successCount > 0 && failedAccounts.length === 0) {
            this.batchAddSuccess = `âœ… æˆåŠŸæ·»åŠ  ${successCount} ä¸ªè´¦å·`;
            this.batchAccounts = '';
            this.maskedBatchAccounts = '';
          } else if (successCount > 0) {
            this.batchAddSuccess = `âœ… æˆåŠŸæ·»åŠ  ${successCount} ä¸ªè´¦å·`;
            this.batchAddError = `âŒ å¤±è´¥: ${failedAccounts.join(', ')}`;
          } else {
            this.batchAddError = `âŒ å…¨éƒ¨å¤±è´¥: ${failedAccounts.join(', ')}`;
          }

          // 3ç§’åæ¸…é™¤æç¤º
          setTimeout(() => {
            this.batchAddSuccess = '';
            if (successCount > 0 && failedAccounts.length === 0) {
              this.batchAddError = '';
            }
          }, 3000);
        },
        async addAccountToList() {
          if (!this.newAccount.name || !this.newAccount.token) {
            this.addAccountError = 'è¯·å¡«å†™è´¦å·åç§°å’Œ API Token';
            return;
          }

          this.addingAccount = true;
          this.addAccountError = '';
          this.addAccountSuccess = '';

          try {
            const response = await fetch('/api/validate-account', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                accountName: this.newAccount.name,
                apiToken: this.newAccount.token
              })
            });

            const data = await response.json();

            if (response.ok) {
              // æ·»åŠ åˆ°æœ¬åœ°åˆ—è¡¨
              this.managedAccounts.push({
                name: this.newAccount.name,
                token: this.newAccount.token,
                balance: this.newAccount.balance ? parseFloat(this.newAccount.balance) : null,
                email: data.userData.email,
                username: data.userData.username
              });

              this.saveManagedAccounts();
              this.addAccountSuccess = `âœ… è´¦å·æ·»åŠ æˆåŠŸï¼ç”¨æˆ·: ${data.userData.username}`;

              // æ¸…ç©ºè¡¨å•
              this.newAccount = { name: '', token: '', balance: '' };

              // åˆ·æ–°æ•°æ®
              setTimeout(() => {
                this.fetchData();
                this.addAccountSuccess = '';
              }, 1500);
            } else {
              this.addAccountError = data.error || 'æ·»åŠ å¤±è´¥';
            }
          } catch (error) {
            this.addAccountError = 'ç½‘ç»œé”™è¯¯: ' + error.message;
          } finally {
            this.addingAccount = false;
          }
        },
        async removeAccount(index) {
          const accountName = this.managedAccounts[index].name;
          const password = prompt(`åˆ é™¤è´¦å·"${accountName}"éœ€è¦éªŒè¯ç®¡ç†å‘˜å¯†ç ï¼š`);

          if (!password) return;

          // éªŒè¯å¯†ç 
          try {
            const response = await fetch('/api/verify-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ password })
            });

            const result = await response.json();
            if (result.success) {
              this.managedAccounts.splice(index, 1);
              await this.saveManagedAccounts();
              this.fetchData();
              alert('è´¦å·å·²åˆ é™¤');
            } else {
              alert('å¯†ç é”™è¯¯ï¼Œåˆ é™¤å¤±è´¥');
            }
          } catch (error) {
            alert('éªŒè¯å¤±è´¥: ' + error.message);
          }
        },
        closeAddModal() {
          this.showAddModal = false;
          this.newAccount = { name: '', token: '', balance: '' };
          this.addAccountError = '';
          this.addAccountSuccess = '';
        },
        closeManageModal() {
          this.showManageModal = false;
          this.newAccount = { name: '', token: '', balance: '' };
          this.addAccountError = '';
          this.addAccountSuccess = '';
        },
        updateOpacity() {
          const opacity = this.opacity / 100;
          const root = document.documentElement;
          if (!root) return; // é˜²æ­¢ DOM æœªåŠ è½½

          // è®¾ç½®æ‰€æœ‰ç›¸å…³çš„CSSå˜é‡
          root.style.setProperty('--card-opacity', opacity);
          root.style.setProperty('--service-opacity', Math.min(opacity + 0.05, 1));
          root.style.setProperty('--blur-amount', `${20 * opacity}px`);
          root.style.setProperty('--blur-amount-small', `${15 * opacity}px`);
          root.style.setProperty('--blur-amount-tiny', `${10 * opacity}px`);
          root.style.setProperty('--saturate-amount', `${100 + 80 * opacity}%`);
          root.style.setProperty('--shadow-opacity', 0.1 * opacity);
          root.style.setProperty('--shadow-opacity-light', 0.05 * opacity);
          root.style.setProperty('--border-opacity', 0.3 * opacity);
          root.style.setProperty('--border-opacity-light', 0.4 * opacity);
          root.style.setProperty('--border-opacity-strong', 0.5 * opacity);
        },
        clearCache() {
          if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰æœ¬åœ°ä¿å­˜çš„è´¦å·ã€ä½™é¢å’Œè´¹ç”¨æ•°æ®ã€‚')) {
            // æ¸…é™¤æ‰€æœ‰æœ¬åœ°æ•°æ®
            this.managedAccounts = [];
            this.projectCosts = {};
            localStorage.removeItem('zeabur_accounts');
            localStorage.removeItem('zeabur_project_costs');

            alert('ç¼“å­˜å·²æ¸…é™¤ï¼æ­£åœ¨é‡æ–°è·å–æ•°æ®...');
            this.fetchData();
          }
        },
        toggleAccount(accountName) {
          this.expandedAccounts[accountName] = !this.expandedAccounts[accountName];
        },
        isAccountExpanded(accountName) {
          return this.expandedAccounts[accountName] !== false;
        },
        // æš‚åœæœåŠ¡
        async pauseService(account, project, service) {
          if (!confirm(`ç¡®å®šè¦æš‚åœæœåŠ¡"${service.name}"å—ï¼Ÿ`)) return;

          try {
            // è·å–ç¯å¢ƒ ID
            const environmentId = project.environments && project.environments[0] ? project.environments[0]._id : null;
            if (!environmentId) {
              alert('âŒ æ— æ³•è·å–ç¯å¢ƒ IDï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•');
              return;
            }

            // è·å–è´¦å· token
            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) {
              alert('âŒ æ— æ³•è·å–è´¦å· tokenï¼Œè¯·é‡æ–°æ·»åŠ è´¦å·');
              return;
            }

            const response = await fetch('/api/service/pause', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                serviceId: service._id,
                environmentId: environmentId
              })
            });

            const result = await response.json();
            if (result.success) {
              alert('âœ… æœåŠ¡å·²æš‚åœ');
              this.fetchData();
            } else {
              alert('âŒ æš‚åœå¤±è´¥: ' + (result.error || JSON.stringify(result)));
            }
          } catch (error) {
            alert('âŒ æ“ä½œå¤±è´¥: ' + error.message);
          }
        },
        // é‡å¯æœåŠ¡
        async restartService(account, project, service) {
          const action = service.status === 'SUSPENDED' ? 'å¯åŠ¨' : 'é‡å¯';
          if (!confirm(`ç¡®å®šè¦${action}æœåŠ¡"${service.name}"å—ï¼Ÿ`)) return;

          try {
            // è·å–ç¯å¢ƒ ID
            const environmentId = project.environments && project.environments[0] ? project.environments[0]._id : null;
            if (!environmentId) {
              alert('âŒ æ— æ³•è·å–ç¯å¢ƒ IDï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•');
              return;
            }

            // è·å–è´¦å· token
            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) {
              alert('âŒ æ— æ³•è·å–è´¦å· tokenï¼Œè¯·é‡æ–°æ·»åŠ è´¦å·');
              return;
            }

            const response = await fetch('/api/service/restart', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                serviceId: service._id,
                environmentId: environmentId
              })
            });

            const result = await response.json();
            if (result.success) {
              alert(`âœ… æœåŠ¡å·²${action}`);
              this.fetchData();
            } else {
              alert(`âŒ ${action}å¤±è´¥: ` + (result.error || JSON.stringify(result)));
            }
          } catch (error) {
            alert('âŒ æ“ä½œå¤±è´¥: ' + error.message);
          }
        },
        // æŸ¥çœ‹æœåŠ¡æ—¥å¿—
        async showServiceLogs(account, project, service) {
          this.logsModalTitle = 'æœåŠ¡æ—¥å¿— - ' + service.name;
          this.logsModalInfo = { project: project.name, account: account.name, count: 0, time: new Date().toLocaleString('zh-CN') };
          this.logsContent = '';
          this.logsLoading = true;
          this.showLogsModal = true;

          try {
            const environmentId = project.environments && project.environments[0] ? project.environments[0]._id : null;
            if (!environmentId) { this.logsContent = 'âŒ æ— æ³•è·å–ç¯å¢ƒ ID'; this.logsLoading = false; return; }

            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) { this.logsContent = 'âŒ æ— æ³•è·å–è´¦å· token'; this.logsLoading = false; return; }

            const response = await fetch('/api/service/logs', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({ token: accountData.token, serviceId: service._id, environmentId: environmentId, projectId: project._id, limit: 200 })
            });

            const result = await response.json();
            if (result.success && result.logs) {
              this.logsContent = result.logs.map(log => '[' + new Date(log.timestamp).toLocaleString('zh-CN') + '] ' + log.message).join('\n');
              this.logsModalInfo.count = result.count;
            } else {
              this.logsContent = 'âŒ è·å–æ—¥å¿—å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯');
            }
          } catch (error) {
            this.logsContent = 'âŒ è·å–æ—¥å¿—å¤±è´¥: ' + error.message;
          } finally {
            this.logsLoading = false;
          }
        },
        // æ ¼å¼åŒ–è´¹ç”¨æ˜¾ç¤ºï¼ˆå°äº $0.01 æ˜¾ç¤ºä¸º $0.01ï¼‰
        formatCost(cost) {
          if (cost > 0 && cost < 0.01) {
            return '0.01';
          }
          return cost.toFixed(2);
        },
        // æ›´æ–°æ‰¹é‡æ·»åŠ çš„æ‰“ç æ˜¾ç¤º
        updateBatchDisplay() {
          if (!this.batchAccounts) {
            this.maskedBatchAccounts = '';
            return;
          }
          const lines = this.batchAccounts.split('\n');
          this.maskedBatchAccounts = lines.map(line => {
            // å°è¯•åŒ¹é…æ‹¬å·æ ¼å¼ï¼šåç§°(token) æˆ– åç§°ï¼ˆtokenï¼‰
            const bracketMatch = line.match(/^(.+?)[ï¼ˆ(](.+?)[ï¼‰)]$/);
            if (bracketMatch) {
              const name = bracketMatch[1];
              const bracket = line.includes('ï¼ˆ') ? 'ï¼ˆ' : '(';
              const closeBracket = line.includes('ï¼‰') ? 'ï¼‰' : ')';
              const maskedToken = bracketMatch[2].replace(/./g, 'â—');
              return name + bracket + maskedToken + closeBracket;
            }

            // å†’å·æ ¼å¼
            let separatorIndex = -1;
            let separator = '';

            if (line.includes(':')) {
              separatorIndex = line.indexOf(':');
              separator = ':';
            } else if (line.includes('ï¼š')) {
              separatorIndex = line.indexOf('ï¼š');
              separator = 'ï¼š';
            }

            if (separatorIndex === -1) return line;

            const name = line.substring(0, separatorIndex);
            const token = line.substring(separatorIndex + 1);
            return name + separator + token.replace(/./g, 'â—');
          }).join('\n');
        },
        // è·å–é¡¹ç›®çš„æ‰€æœ‰åŸŸå
        getProjectDomains(project) {
          const domains = [];
          if (project.services) {
            project.services.forEach(service => {
              if (service.domains && service.domains.length > 0) {
                service.domains.forEach(d => {
                  if (d.domain) {
                    domains.push({
                      domain: d.domain,
                      isGenerated: d.isGenerated || false
                    });
                  }
                });
              }
            });
          }
          return domains;
        },
        // å¼€å§‹ç¼–è¾‘é¡¹ç›®åç§°
        startEditProjectName(project) {
          project.isEditing = true;
          project.editingName = project.name;
          setTimeout(() => {
            try {
              // åªåœ¨å½“å‰é¡¹ç›®èŒƒå›´å†…æŸ¥æ‰¾è¾“å…¥ï¼Œé¿å…å…¨å±€ querySelectorAll
              const el = document.getElementById('proj-' + project._id);
              if (el) {
                const input = el.querySelector('.edit-input');
                if (input) input.focus();
              }
            } catch (e) { console.error(e); }
          }, 50);
        },
        // å–æ¶ˆç¼–è¾‘é¡¹ç›®åç§°
        cancelEditProjectName(project) {
          project.isEditing = false;
          project.editingName = '';
        },
        // ä¿å­˜é¡¹ç›®åç§°
        async saveProjectName(account, project) {
          // å¦‚æœä¸åœ¨ç¼–è¾‘çŠ¶æ€ï¼Œç›´æ¥è¿”å›ï¼ˆé¿å… blur äº‹ä»¶é‡å¤è§¦å‘ï¼‰
          if (!project.isEditing) {
            return;
          }

          if (!project.editingName || project.editingName.trim() === '') {
            alert('âŒ é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º');
            return;
          }

          if (project.editingName === project.name) {
            this.cancelEditProjectName(project);
            return;
          }

          try {
            const accountData = this.managedAccounts.find(acc => acc.name === account.name);
            if (!accountData || !accountData.token) {
              alert('âŒ æ— æ³•è·å–è´¦å· tokenï¼Œè¯·é‡æ–°æ·»åŠ è´¦å·');
              return;
            }

            const response = await fetch('/api/project/rename', {
              method: 'POST',
              headers: this.getAuthHeaders(),
              body: JSON.stringify({
                token: accountData.token,
                projectId: project._id,
                newName: project.editingName.trim()
              })
            });

            const result = await response.json();
            if (result.success) {
              project.name = project.editingName.trim();
              this.cancelEditProjectName(project);
              alert('âœ… é¡¹ç›®åç§°å·²æ›´æ–°');
            } else {
              alert('âŒ æ›´æ–°å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
            }
          } catch (error) {
            alert('âŒ æ“ä½œå¤±è´¥: ' + error.message);
          }
        }
      }
    }).mount('#app');
  </script>

</body>

</html>